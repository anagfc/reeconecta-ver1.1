@using System.Security.Claims
@model reeconecta.Models.Produto

@{
    ViewData["Title"] = "Detalhes do Produto";
    var usuarioLogadoId = User.FindFirstValue(ClaimTypes.NameIdentifier);
    bool isAnunciante = usuarioLogadoId == Model.AnuncianteId.ToString();
}


    <button class="btn btn-link float-end" onclick="window.history.back();">
        <i class="bi bi-x-lg fs-4"></i>
    </button>
<div class="container mt-5"><br>
    <h4>Detalhes do Produto</h4><br>

    <div class="row">
        <div class="col-md-4 text-center">
            <img src="@Model.Imagem" alt="Imagem do produto" class="img-fluid rounded border" style="max-height: 300px;" />
            <p><em>Imagem do produto</em></p>
        </div>
        <div class="col-md-7">
            <h3>@Model.Titulo</h3><br />
            <p><strong>Preço:</strong><br />R$ @Model.Preco.ToString("F2")</p>
            <p><strong>Condição:</strong><br />@Model.Condicao</p>
            <p><strong>Descrição:</strong><br /><em>@Model.Descricao</em></p>
            <p><strong>Localização:</strong><br />@Model.Bairro - @Model.Cidade</p>


            @if (!isAnunciante)
            {
                <a href="https://wa.me/@Model.Usuario?.Telefone01" target="_blank" class="btn btn-outline-success w-100 mt-4" style="font-weight: 600;">
                    <i class="bi bi-whatsapp me-2"></i> Entre em contato com o anunciante
                </a>
            }
            else
            {
                <br />
                <div class="mt-3">
                    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-link">
                        <i class="bi bi-pencil fs-5 text-primary"></i> 
                    </a>

                    <form asp-action="Delete" asp-route-id="@Model.Id" method="post" class="d-inline">
                        <button type="submit" class="btn">
                            <i class="bi bi-trash fs-5 text-danger"></i>
                        </button>
                    </form>
                </div>
                <hr />
                <h5>Interessados neste produto</h5>

                @if (!Model.ReservasProduto?.Any() ?? true)
                {
                    <p class="text-muted">Nenhum interessado até o momento.</p>
                }
                else
                {
                    <div class="list-group mt-3">
                        @foreach (var reserva in Model.ReservasProduto)
                        {
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>@reserva.Usuario?.Nome</strong><br />
                                    Reservado em @reserva.DataReserva.ToString("dd/MM/yyyy")<br />
                                    Status:
                                    @switch (reserva.Status)
                                    {
                                        case reeconecta.Models.StatusReserva.Pendente:
                                            <span class="badge bg-warning text-dark">Pendente</span>
                                            ;
                                            break;
                                        case reeconecta.Models.StatusReserva.Confirmada:
                                            <span class="badge bg-success">Confirmada</span>
                                            ;
                                            break;
                                        case reeconecta.Models.StatusReserva.Cancelada:
                                            <span class="badge bg-danger">Cancelada</span>
                                            ;
                                            break;
                                    }
                                </div>
                                <div>
                                    @if (reserva.Status == reeconecta.Models.StatusReserva.Pendente)
                                    {
                                        <a asp-controller="Produtos" asp-action="Confirmar" asp-route-id="@reserva.Id"
                                           class="btn btn-sm btn-success me-2" title="Confirmar reserva">
                                            <i class="bi bi-check-lg"></i>
                                        </a>
                                        <a asp-controller="Produtos" asp-action="Recusar" asp-route-id="@reserva.Id"
                                           class="btn btn-sm btn-danger" title="Recusar reserva">
                                            <i class="bi bi-x-lg"></i>
                                        </a>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                }
            }
        </div>
    </div>
</div>
